# Тест кейсы для UC MVP

## Тест кейсы для UC1 - Сформировать отчет по сроку годности

### TC-1.1.1: Успешное формирование отчета с базовыми параметрами

**Предусловия:**

- В системе есть партии с разными сроками годности
- API доступен и аутентифицирован

**Шаги:**

1. Вызвать GET /api/reports/expiration с минимальными параметрами
2. Проверить ответ API

**Ожидаемый результат:**

- HTTP 200 OK
- Тело ответа содержит массив партий с обязательными колонками
- Время ответа < 7 секунд

### TC-1.1.2: Фильтрация отчета по зоне хранения

**Предусловия:**

- Существуют партии в разных зонах хранения
- Справочник зон заполнен через UC5

**Шаги:**

1. Вызвать GET /api/reports/expiration?zone=ХОЛОДИЛЬНИК_1
2. Проверить ответ

**Ожидаемый результат:**

- Возвращены только партии из указанной зоны
- Все партии имеют location_id = ХОЛОДИЛЬНИК_1

### TC-1.1.3: Проверка соответствия данных на момент формирования

**Предусловия:**

- Есть активные операции с остатками

**Шаги:**

1. Зафиксировать текущие остатки партии X
2. Сформировать отчет
3. Изменить остатки партии X через UC4
4. Снова сформировать отчет

**Ожидаемый результат:**

- Первый отчет показывает старые остатки
- Второй отчет показывает новые остатки
- Данные в каждом отчете соответствуют моменту формирования

### TC-1.2.1: Отображение цветовой индикации статусов

**Предусловия:**

- В системе есть партии с разными статусами сроков

**Шаги:**

1. Открыть страницу отчета в веб-интерфейсе
2. Проверить цветовое кодирование строк

**Ожидаемый результат:**

- Просроченные партии - красный фон
- Истекающие сегодня - желтый фон
- Истекающие завтра - оранжевый фон
- Заблокированные - серый фон
- Нормальные - белый/зеленый фон

### TC-1.2.2: Сортировка по сроку годности по умолчанию

**Предусловия:**

- В системе есть партии с разными датами expiration_date

**Шаги:**

1. Открыть страницу отчета
2. Проверить порядок сортировки

**Ожидаемый результат:**

- Партии отсортированы по expiration_date ASC
- Самые ранние сроки вверху таблицы

## Тест кейсы для UC2-MVP - Утилизировать партию по отчету

### TC-2.1.1: Сканирование партии из отчета для утилизации

**Предусловия:**

- В отчете UC1 есть партии к утилизации
- Оператор авторизован в мобильном приложении

**Шаги:**

1. Открыть отчет UC1 в мобильном приложении
2. Выбрать партию для утилизации
3. Сканировать штрих-код партии

**Ожидаемый результат:**

- Система подтверждает, что партия находится в отчете "к утилизации"
- Отображаются данные партии
- Процесс занимает не более 10 секунд

### TC-2.2.1: Подтверждение утилизации через API

**Предусловия:**

- Партия отсканирована и подтверждена для утилизации

**Шаги:**

1. Нажать "Подтвердить утилизацию" в мобильном приложении
2. Подтвердить действие в диалоговом окне

**Ожидаемый результат:**

- Остаток партии установлен в 0
- Статус партии изменен на "Утилизирована"
- Зафиксирован акт списания с причиной "Утилизация по сроку годности"

### TC-2.3.1: Попытка утилизации партии не из отчета

**Предусловия:**

- Оператор пытается утилизировать партию, которой нет в отчете UC1

**Шаги:**

1. Сканировать штрих-код партии, не входящей в отчет
2. Попытаться подтвердить утилизацию

**Ожидаемый результат:**

- Система показывает предупреждение "Данная партия не значится в отчете к утилизации"
- Процесс утилизации прерывается

## Тест кейсы для UC3-MVP - Пополнить оперативный запас у робота по отчету

### TC-3.1.1: Выбор партии из отчета для пополнения

**Предусловия:**

- В отчете UC1 есть партии полуфабриката, требующего пополнения
- Оператор визуально видит низкий запас на линии

**Шаги:**

1. Открыть отчет UC1 для нужного полуфабриката
2. Выбрать партию из верхней строки отчета (по FEFO)

**Ожидаемый результат:**

- Отчет показывает партии отсортированные по FEFO
- Оператор может выбрать партию для пополнения

### TC-3.2.1: Фиксация перемещения через API

**Предусловия:**

- Оператор выбрал партию и переместил полуфабрикаты на линию

**Шаги:**

1. В мобильном приложении выбрать "Зафиксировать перемещение"
2. Ввести количество (по умолчанию = 1)
3. Подтвердить операцию

**Ожидаемый результат:**

- Количество списано со складской партии
- Количество добавлено к оперативному запасу линии
- Зафиксирован акт внутреннего перемещения
- Процесс занимает не более 20 секунд

### TC-3.3.1: Обнаружение просроченной партии при пополнении

**Предусловия:**

- Оператор выбрал партию с истекшим сроком годности

**Шаги:**

1. Сканировать штрих-код просроченной партии
2. Попытаться зафиксировать перемещение

**Ожидаемый результат:**

- Система показывает предупреждение о просроченной партии
- Оператор должен отказаться от использования и сообщить технологу

## Тест кейсы для UC4 - Провести инвентаризацию

### TC-4.1.1: Оффлайн-работа мобильного приложения

**Предусловия:**

- Мобильное устройство не имеет сетевого соединения
- Данные партий предварительно закэшированы

**Шаги:**

1. Открыть мобильное приложение без сети
2. Начать инвентаризацию
3. Сканировать несколько партий и ввести фактические количества

**Ожидаемый результат:**

- Данные сохраняются в локальном кэше
- Сканирование и ввод работают без сетевого соединения
- Внесение данных по одной партии занимает 3-5 секунд

### TC-4.2.1: Автоматическая коррекция остатков при малых расхождениях

**Предусловия:**

- Проведена инвентаризация с расхождениями ≤ 4000 ед.

**Шаги:**

1. Завершить инвентаризацию в мобильном приложении
2. Дождаться синхронизации с сервером

**Ожидаемый результат:**

- Система автоматически корректирует остатки
- Формируется электронный акт инвентаризации
- Корректировка выполняется под учёткой оператора

### TC-4.2.2: Уведомление технолога при больших расхождениях

**Предусловия:**

- Проведена инвентаризация с расхождениями > 4000 ед.

**Шаги:**

1. Завершить инвентаризацию с большими расхождениями
2. Проверить уведомления технолога

**Ожидаемый результат:**

- Система блокирует позицию для разбирательства
- Технолог получает уведомление
- Требуется подтверждение технолога для коррекции

### TC-4.3.1: Последовательное сканирование партий

**Предусловия:**

- Оператор проводит инвентаризацию в зоне с множеством партий

**Шаги:**

1. Сканировать штрих-код первой партии
2. Ввести фактическое количество
3. Перейти к следующей партии

**Ожидаемый результат:**

- После внесения данных фокус автоматически переходит на поле для сканирования следующего штрих-кода
- Автозаполнение данных при распознавании штрих-кода

### TC-4.4.1: Разрешение конфликтов при синхронизации

**Предусловия:**

- Во время оффлайн-работы произошли изменения в системе

**Шаги:**

1. Восстановить сетевое соединение
2. Отправить оффлайн-данные на сервер
3. Получить уведомление о конфликтах

**Ожидаемый результат:**

- Система обнаруживает конфликтующие изменения
- Запрашивает решение оператора по приоритету данных
- Применяет выбранный оператором приоритет

## Тест кейсы для UC5 - Вести справочники

### TC-5.1.1: Создание новой номенклатурной позиции

**Предусловия:**

- Технолог авторизован в веб-интерфейсе
- Имеет права на редактирование справочников

**Шаги:**

1. Открыть раздел "Справочники" -> "Номенклатура"
2. Нажать "Добавить"
3. Заполнить обязательные атрибуты: название, ед. измерения, категория, срок хранения
4. Сохранить

**Ожидаемый результат:**

- Система проверяет уникальность наименования
- Создается новая запись в справочнике номенклатуры
- Новая позиция доступна для заказа, учета и инвентаризации

### TC-5.1.2: Попытка удаления позиции с историей операций

**Предусловия:**

- Существует номенклатурная позиция с историей приходов/движений

**Шаги:**

1. Выбрать позицию с историей операций
2. Попытаться удалить позицию

**Ожидаемый результат:**

- Система запрещает удаление позиции
- Предлагает вариант деактивации/архивации
- Позиция исключается из выпадающих списков для нового заказа

### TC-5.2.1: Создание иерархии складских зон

**Предусловия:**

- Технолог работает с подразделом "Складские зоны"

**Шаги:**

1. Создать новую зону хранения
2. Назначить тип зоны из справочника типов
3. Указать родительскую зону
4. Назначить штрих-код зоны

**Ожидаемый результат:**

- Система сохраняет иерархическую структуру зон
- Зона доступна для использования в инвентаризациях и отчетах
- Штрих-код зоны может сканироваться оператором

### TC-5.3.1: Проверка ролевой модели доступа

**Предусловия:**

- Существуют пользователи с разными ролями

**Шаги:**

1. Войти под пользователем с ролью "Оператор"
2. Попытаться открыть раздел "Справочники"

**Ожидаемый результат:**

- Доступ к редактированию справочников запрещен
- Оператор может только просматривать данные
- Система показывает сообщение о недостатке прав

## Тест кейсы для UC6 - Скорректировать заказ

### TC-6.1.1: Просмотр черновика заказа с обоснованием

**Предусловия:**

- Система сформировала черновик заказа через UC8
- Технолог авторизован в системе

**Шаги:**

1. Открыть раздел "Заказы"
2. Выбрать заказ со статусом "Черновик"
3. Просмотреть обоснование по позициям

**Ожидаемый результат:**

- Отображается детализация расчета для каждой позиции
- Видны: остаток, точка заказа, рекомендуемое количество
- Цветовая индикация измененных технологом позиций

### TC-6.1.2: Ручное изменение количества в заказе

**Предусловия:**

- Открыт черновик заказа для редактирования

**Шаги:**

1. Изменить количество для одной из позиций
2. Добавить новую позицию в заказ
3. Удалить позицию из заказа

**Ожидаемый результат:**

- Система сохраняет изменения в черновике
- Измененные позиции помечаются специальным цветом
- Валидация: количество > 0 и числовое значение

### TC-6.2.1: Утверждение заказа с отправкой в ЛЦ

**Предусловия:**

- Черновик заказа откорректирован и готов к отправке

**Шаги:**

1. Нажать кнопку "Утвердить и отправить"
2. Подтвердить действие в диалоговом окне

**Ожидаемый результат:**

- Статус заказа изменен на "Отправлен в ЛЦ"
- Все действия технолога залогированы
- Заказ передается в ЛЦ через UC12

### TC-6.2.2: Отклонение заказа с указанием причины

**Предусловия:**

- Черновик заказа не требуется формировать

**Шаги:**

1. Нажать кнопку "Отклонить"
2. Указать причину отклонения
3. Подтвердить действие

**Ожидаемый результат:**

- Статус заказа изменен на "Отклонен"
- Заказ архивируется с указанием причины
- Уведомление не отправляется в ЛЦ
