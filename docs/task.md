# Постановки на разработку по UserStory

## Постановки на разработку функционала, реализуемого в рамках MVP

### US1.1: Внесение и редактирование номенклатуры

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Требования понятны и согласованы с технологом
- [ ] Дизайн интерфейса ведения справочника утвержден
- [ ] Определен полный набор атрибутов полуфабриката
- [ ] Готовы API endpoints для работы с номенклатурой
- [ ] Определены валидации данных (уникальность наименования и т.д.)

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован интерфейс создания/редактирования полуфабрикатов
- [ ] Реализована валидация вводимых данных
- [ ] Данные сохраняются в базу и доступны для других процессов
- [ ] Написаны и проходят unit-тесты
- [ ] Код прошел code review
- [ ] Функциональность протестирована на тестовом стенде

#### Критерии приемки (Acceptance Criteria):

- [ ] Технолог может добавить новый полуфабрикат с обязательными полями: название, единица измерения, категория
- [ ] Система проверяет уникальность наименования
- [ ] При редактировании существующей позиции изменения сохраняются
- [ ] Новый полуфабрикат сразу доступен для использования в заказах и инвентаризации

#### Задачи:

- Создать таблицу `products` в БД
- Реализовать REST API для CRUD операций
- Разработать UI форму ввода/редактирования
- Реализовать валидацию данных
- Написать тесты

---

### US1.2: Указание сроков хранения

#### Definition of Ready (DoR):

- [ ] US1.1 завершена и протестирована
- [ ] Определен формат хранения сроков (часы/дни)
- [ ] Согласованы бизнес-правила валидации сроков
- [ ] Готовы требования к интерфейсу ввода сроков

#### Definition of Done (DoD):

- [ ] Добавлено поле "Срок хранения" в форму полуфабриката
- [ ] Реализована валидация срока (положительное число)
- [ ] Срок хранения учитывается при расчете даты истечения срока годности
- [ ] Протестирована корректность расчетов на основе введенных сроков

#### Критерии приемки:

- [ ] Технолог может указать срок хранения в часах для каждого полуфабриката
- [ ] Система не позволяет сохранить отрицательный или нулевой срок
- [ ] Указанный срок используется для автоматического расчета даты истечения срока годности партий
- [ ] При создании партии система рассчитывает expiration_date на основе production_date + срок хранения

#### Задачи:

- Добавить поле `shelf_life_hours` в таблицу products
- Обновить UI форму
- Реализовать валидацию срока хранения
- Интегрировать с логикой расчета сроков годности
- Протестировать расчеты

---

### US1.3: Управление складскими зонами

#### Definition of Ready (DoR):

- [ ] Определена иерархическая структура зон хранения
- [ ] Утверждены типы зон (холодильник, морозильник, оперативный запас)
- [ ] Согласованы атрибуты зоны (название, тип, родительская зона)
- [ ] Готовы требования к интерфейсу управления зонами

#### Definition of Done (DoD):

- [ ] Реализован интерфейс создания/редактирования складских зон
- [ ] Поддержана иерархическая структура зон
- [ ] Реализована валидация данных зоны
- [ ] Зоны доступны для выбора при проведении инвентаризации
- [ ] Данные зон интегрированы с системой учета остатков

#### Критерии приемки:

- [ ] Технолог может создать новую складскую зону с указанием названия и типа
- [ ] Можно создать иерархию зон (например: Склад → Холодильная камера → Стеллаж 1)
- [ ] Система не позволяет удалить зону, если в ней есть остатки партий
- [ ] При инвентаризации оператор может выбрать конкретную зону для подсчета

#### Задачи:

- Создать таблицы `storage_locations` и `location_types`
- Реализовать API для управления зонами
- Разработать UI для иерархического отображения зон
- Интегрировать с модулем инвентаризации
- Реализовать проверки при удалении зон

---

### US2.1: Проведение инвентаризации через мобильное приложение

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US1.1, US1.2, US1.3 (справочники номенклатуры и зон)
- [ ] Готовы API endpoints для мобильного приложения
- [ ] Определен формат данных для оффлайн-работы
- [ ] Утвержден дизайн мобильного интерфейса сканирования
- [ ] Определены типы инвентаризации (сплошная/выборочная)

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован интерфейс сканирования штрих-кодов в мобильном приложении
- [ ] Поддержан оффлайн-режим с кэшированием данных
- [ ] Реализована валидация штрих-кодов партий
- [ ] Данные инвентаризации корректно синхронизируются при появлении сети
- [ ] Написаны и проходят автотесты для мобильного приложения

#### Критерии приемки (Acceptance Criteria):

- [ ] Оператор может сканировать штрих-код партии и видеть автоматическое заполнение данных
- [ ] При повреждении штрих-кода возможен ручной ввод ID партии
- [ ] Система работает оффлайн и синхронизирует данные при восстановлении связи
- [ ] Время сканирования и ввода одной партии не превышает 3-5 секунд
- [ ] Интерфейс оптимизирован для последовательного сканирования

#### Задачи:

- Разработать мобильный интерфейс сканирования
- Реализовать оффлайн-кэширование данных партий
- Интегрировать сканер штрих-кодов
- Реализовать валидацию штрих-кодов
- Настроить синхронизацию оффлайн-данных

---

### US2.2: Автоматическая сверка данных и отчет о расхождениях

#### Definition of Ready (DoR):

- [ ] US2.1 завершена и протестирована
- [ ] Определен алгоритм сверки фактических и системных данных
- [ ] Утвержден формат отчета о расхождениях
- [ ] Определены пороги для автоматической коррекции (≤ 4000 ед.) и ручного утверждения (> 4000 ед.)

#### Definition of Done (DoD):

- [ ] Реализован алгоритм автоматической сверки данных инвентаризации
- [ ] Система формирует отчет о расхождениях с цветовой индикацией
- [ ] Реализована автоматическая коррекция для малых расхождений
- [ ] Для больших расхождений создаются задания на утверждение технологу
- [ ] Отчет доступен для просмотра в веб-интерфейсе

#### Критерии приемки:

- [ ] После синхронизации система автоматически сверяет фактические данные с системными остатками
- [ ] Формируется отчет с расхождениями (излишки/недостачи) по каждой позиции
- [ ] При расхождениях ≤ 4000 ед. система автоматически корректирует остатки
- [ ] При расхождениях > 4000 ед. система уведомляет технолога и ожидает утверждения
- [ ] Отчет включает дату, время, зону, ответственного и все позиции с расхождениями

#### Задачи:

- Реализовать алгоритм сверки остатков
- Разработать генератор отчетов о расхождениях
- Реализовать автоматическую коррекцию для малых расхождений
- Интегрировать с системой уведомлений технолога
- Создать веб-интерфейс для просмотра отчетов

---

### US2.3: Автоматическая коррекция остатков после подтверждения

#### Definition of Ready (DoR):

- [ ] US2.2 завершена и протестирована
- [ ] Определены бизнес-правила коррекции остатков
- [ ] Готовы API endpoints для подтверждения инвентаризации
- [ ] Утвержден процесс утверждения больших расхождений технологом

#### Definition of Done (DoD):

- [ ] Реализована атомарная коррекция остатков в базе данных
- [ ] Система фиксирует акт инвентаризации с полным аудитом
- [ ] Коррекция остатков оперативного запаса не влияет на виртуальный срок годности
- [ ] Данные для автозаказа актуализируются после коррекции
- [ ] Гарантирована консистентность данных даже при сбоях

#### Критерии приемки:

- [ ] После подтверждения инвентаризации система автоматически корректирует остатки в базе данных
- [ ] При коррекции оперативного запаса меняется только количество, виртуальный срок годности сохраняется
- [ ] Система не позволяет корректировать остатки по заблокированным партиям
- [ ] Все коррекции фиксируются в акте инвентаризации с указанием ответственного
- [ ] После коррекции данные для автозаказа и контроля сроков годности актуализируются

#### Задачи:

- Реализовать транзакционную коррекцию остатков
- Создать систему фиксации актов инвентаризации
- Интегрировать с модулем оперативного запаса
- Реализовать проверки блокировок партий
- Обновить данные для автозаказа после коррекции

---

### US3.1: Ежедневный расчет рекомендуемого заказа

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US1.1, US1.2, US1.3 (справочники номенклатуры)
- [ ] Завершены US2.1, US2.2, US2.3 (инвентаризация и остатки)
- [ ] Готовы API endpoints для расчета автозаказа
- [ ] Определен алгоритм расчета на основе правил (Min/Max)
- [ ] Утвержден формат черновика заказа
- [ ] Настроено расписание ежедневного расчета

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован алгоритм расчета заказа по правилам Min/Max
- [ ] Система автоматически запускает расчет по расписанию
- [ ] Расчет учитывает текущие остатки и незавершенные заказы
- [ ] Сформированный черновик заказа сохраняется в базе данных
- [ ] Технолог получает уведомление о готовности черновика

#### Критерии приемки (Acceptance Criteria):

- [ ] Система ежедневно рассчитывает рекомендуемый заказ на основе текущих остатков и правил Min/Max
- [ ] Расчет выполняется автоматически по установленному расписанию
- [ ] В расчете учитываются только активные правила автозаказа
- [ ] Сформированный черновик заказа включает позиции с количеством > 0
- [ ] Технолог получает уведомление в интерфейсе системы о готовности черновика

#### Задачи:

- Реализовать алгоритм расчета по правилам Min/Max
- Настроить scheduled job для ежедневного расчета
- Разработать генератор черновиков заказов
- Интегрировать с системой уведомлений
- Реализовать хранение черновиков в БД

---

### US3.2: Просмотр черновика заказа с обоснованием

#### Definition of Ready (DoR):

- [ ] US3.1 завершена и протестирована
- [ ] Утвержден формат отображения обоснования расчета
- [ ] Готовы API endpoints для получения деталей заказа
- [ ] Определены данные для обоснования (остаток, точка заказа и т.д.)

#### Definition of Done (DoD):

- [ ] Реализован интерфейс просмотра черновика заказа
- [ ] По каждой позиции отображается детальное обоснование расчета
- [ ] Интерфейс поддерживает сортировку и фильтрацию позиций
- [ ] Данные загружаются быстро даже при большом количестве позиций

#### Критерии приемки:

- [ ] Технолог может просмотреть сформированный черновик заказа
- [ ] По каждой позиции отображается обоснование расчета ("остаток X, точка заказа Y")
- [ ] Технолог видит детализацию: текущий остаток, точку заказа, максимальный запас
- [ ] Интерфейс загружается не более чем за 5-7 секунд даже для заказов с сотнями позиций
- [ ] Поддерживается пагинация и поиск по позициям заказа

#### Задачи:

- Разработать веб-интерфейс просмотра заказов
- Реализовать отображение обоснования по позициям
- Оптимизировать загрузку данных (пагинация, lazy loading)
- Реализовать сортировку и фильтрацию
- Добавить поиск по наименованиям продуктов

---

### US3.3: Ручная корректировка черновика заказа

#### Definition of Ready (DoR):

- [ ] US3.2 завершена и протестирована
- [ ] Определены бизнес-правила редактирования заказа
- [ ] Утвержден интерфейс редактирования количеств и состава
- [ ] Готовы API endpoints для корректировки заказа

#### Definition of Done (DoD):

- [ ] Реализован интерфейс редактирования количеств в заказе
- [ ] Поддержано добавление новых позиций в заказ
- [ ] Реализовано удаление позиций из заказа
- [ ] Изменения сохраняются в черновике заказа
- [ ] Валидация вводимых количеств (положительные числа)

#### Критерии приемки:

- [ ] Технолог может вручную откорректировать количество для любой позиции в черновике заказа
- [ ] Можно удалить позицию из заказа (например, зная о отсутствии товара у поставщика)
- [ ] Можно добавить новую позицию в заказ (например, новый товар для теста)
- [ ] Система проверяет, что вводимые количества являются положительными числами
- [ ] После корректировки заказ сохраняется как черновик для последующего утверждения

#### Задачи:

- Реализовать UI для редактирования количеств
- Добавить функциональность добавления/удаления позиций
- Реализовать валидацию вводимых данных
- Обновить механизм сохранения черновиков
- Протестировать сценарии корректировки

---

### US3.4: Отклонение заказа с указанием причины

#### Definition of Ready (DoR):

- [ ] US3.3 завершена и протестирована
- [ ] Определен перечень причин отклонения заказа
- [ ] Утвержден процесс архивации отклоненных заказов
- [ ] Готовы API endpoints для отклонения заказов

#### Definition of Done (DoD):

- [ ] Реализована функция отклонения заказа с выбором причины
- [ ] Поддержан произвольный комментарий при отклонении
- [ ] Отклоненные заказы архивируются с сохранением истории
- [ ] Система не отправляет отклоненные заказы в ЛЦ
- [ ] Ведутся логи всех действий по отклонению заказов

#### Критерии приемки:

- [ ] Технолог может отклонить заказ с указанием причины (например, "закрыто на мойку")
- [ ] При отклонении требуется обязательное указание причины
- [ ] Отклоненный заказ переходит в статус "Отклонен" и архивируется
- [ ] Система ведет учет причин отсутствия заказов для анализа
- [ ] Отклоненный заказ не передается в логистический центр

#### Задачи:

- Реализовать UI для отклонения заказов
- Создать справочник причин отклонения
- Реализовать архивацию отклоненных заказов
- Интегрировать с системой логирования
- Настроить валидацию обязательного указания причины

### US4.1: Формирование отчета по сроку годности

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US1.1, US1.2, US1.3 (справочники номенклатуры и зон)
- [ ] Завершены US2.1, US2.2, US2.3 (учет остатков)
- [ ] Готовы API endpoints для формирования отчетов
- [ ] Определены параметры отчета (зоны, статусы, форматы)
- [ ] Утвержден дизайн отчета с цветовой индикацией

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован интерфейс формирования отчета по срокам годности
- [ ] Отчет включает все необходимые колонки: штрих-код, наименование, партия, срок годности, остаток, локация, статус
- [ ] Реализована цветовая индикация статусов партий
- [ ] Отчет формируется не более чем за 5-7 секунд
- [ ] Поддержана фильтрация и сортировка данных

#### Критерии приемки (Acceptance Criteria):

- [ ] Оператор или технолог может сформировать отчет по срокам годности
- [ ] Отчет отображает актуальные остатки полуфабрикатов с детализацией по партиям
- [ ] Цветовая индикация: красный - просроченные, желтый - истекают сегодня, оранжевый - истекают завтра
- [ ] Отчет автоматически сортируется по сроку годности (самые проблемные вверху)
- [ ] Данные в отчете соответствуют данным на момент формирования (консистентность)

#### Задачи:

- Разработать UI формирования отчетов
- Реализовать генератор отчетов с фильтрацией
- Добавить цветовую индикацию статусов
- Оптимизировать производительность формирования отчета
- Реализовать сортировку по сроку годности

---

### US4.2: Цветовая индикация в отчете

#### Definition of Ready (DoR):

- [ ] US4.1 завершена и протестирована
- [ ] Утверждена цветовая схема индикации статусов
- [ ] Определены правила определения статусов партий
- [ ] Готовы алгоритмы расчета цветов для разных статусов

#### Definition of Done (DoD):

- [ ] Реализована цветовая подсветка строк в отчете
- [ ] Цвета соответствуют утвержденной схеме: красный/желтый/оранжевый/зеленый
- [ ] Индикация работает корректно при фильтрации и сортировке
- [ ] Цвета понятны и различимы для пользователей

#### Критерии приемки:

- [ ] Просроченные партии подсвечиваются красным цветом
- [ ] Партии, истекающие сегодня, подсвечиваются желтым цветом
- [ ] Партии, истекающие завтра, подсвечиваются оранжевым цветом
- [ ] Партии с нормальным сроком годности отображаются белым/зеленым цветом
- [ ] Заблокированные партии отображаются серым цветом
- [ ] Цветовая индикация помогает быстро идентифицировать проблемные партии

#### Задачи:

- Реализовать алгоритм определения цветов статусов
- Настроить CSS стили для цветовой индикации
- Протестировать отображение на разных устройствах
- Интегрировать с механизмом формирования отчетов
- Проверить доступность цветов для пользователей с нарушением цветовосприятия

---

### US4.3: Сканирование и подтверждение утилизации по отчету

#### Definition of Ready (DoR):

- [ ] US4.1, US4.2 завершены и протестированы
- [ ] Готовы API endpoints для подтверждения утилизации
- [ ] Интегрирован сканер штрих-кодов в мобильное приложение
- [ ] Определен процесс подтверждения утилизации

#### Definition of Done (DoD):

- [ ] Реализована функция сканирования партий из отчета в мобильном приложении
- [ ] Система проверяет, что сканируемая партия есть в отчете "к утилизации"
- [ ] Реализовано подтверждение утилизации с списанием остатков
- [ ] Поддержан ручной ввод при повреждении штрих-кода
- [ ] Ведутся логи всех операций утилизации

#### Критерии приемки:

- [ ] Оператор может сканировать штрих-код партии из отчета в мобильном приложении
- [ ] Система подтверждает, что партия находится в отчете "к утилизации"
- [ ] При сканировании партии, которой нет в отчете, система показывает предупреждение
- [ ] После подтверждения утилизации остатки партии списываются до нуля
- [ ] Статус партии изменяется на "Утилизирована"

#### Задачи:

- Интегрировать сканирование с мобильным приложением
- Реализовать проверку партий в отчете
- Разработать процесс подтверждения утилизации
- Реализовать списание остатков при утилизации
- Добавить логирование операций утилизации

---

### US4.4: Формирование отчета по пополнению

#### Definition of Ready (DoR):

- [ ] Завершены US4.1, US4.2 (формирование отчетов)
- [ ] Определены критерии для отчета по пополнению
- [ ] Утвержден формат и содержание отчета
- [ ] Готовы API endpoints для отчетов по пополнению

#### Definition of Done (DoD):

- [ ] Реализован отчет, показывающий полуфабрикаты, нуждающиеся в пополнении
- [ ] Отчет включает текущие остатки и рекомендуемое количество для пополнения
- [ ] Данные актуальны на момент формирования отчета
- [ ] Отчет доступен в веб-интерфейсе для оператора

#### Критерии приемки:

- [ ] Оператор может сформировать отчет, показывающий какие полуфабрикаты нуждаются в пополнении
- [ ] Отчет отображает текущие остатки на складе и на линии
- [ ] Показываются полуфабрикаты с остатком ниже минимального порога
- [ ] Отчет помогает оператору принять решение о необходимости пополнения
- [ ] Данные в отчете обновляются в реальном времени

#### Задачи:

- Разработать алгоритм определения потребности в пополнении
- Создать генератор отчета по пополнению
- Интегрировать с данными остатков со склада и линии
- Реализовать веб-интерфейс отчета
- Настроить автоматическое обновление данных

---

### US4.5: Отчет с сортировкой по FEFO

#### Definition of Ready (DoR):

- [ ] US4.4 завершена и протестирована
- [ ] Определен алгоритм сортировки по принципу FEFO
- [ ] Утвержден формат отчета с FEFO сортировкой
- [ ] Готовы API endpoints для FEFO выборки

#### Definition of Done (DoD):

- [ ] Реализован отчет с сортировкой партий по сроку годности (FEFO)
- [ ] В отчете партии отсортированы от самых старых к самым новым
- [ ] Отчет помогает выбрать правильную партию для пополнения линии
- [ ] Данные актуальны и соответствуют фактическим остаткам

#### Критерии приемки:

- [ ] Оператор может сформировать отчет, отсортированный по сроку годности (FEFO)
- [ ] В отчете партии отсортированы от самых близких к истечению срока к самым дальним
- [ ] Отчет помогает выбрать партию с самым близким сроком годности для пополнения линии
- [ ] При пополнении оператор использует данные из этого отчета для выбора партии
- [ ] Сортировка корректно работает для всех типов полуфабрикатов

#### Задачи:

- Реализовать алгоритм FEFO сортировки
- Интегрировать FEFO сортировку в генератор отчетов
- Протестировать корректность сортировки
- Обновить UI отчетов с поддержкой FEFO
- Документировать процесс использования FEFO отчета

---

### US4.6: Ручная фиксация перемещения на линию

#### Definition of Ready (DoR):

- [ ] US4.5 завершена и протестирована
- [ ] Готовы API endpoints для фиксации перемещений
- [ ] Интегрирован сканер штрих-кодов в мобильное приложение
- [ ] Определен процесс ручной фиксации перемещений

#### Definition of Done (DoD):

- [ ] Реализована функция ручной фиксации перемещения в мобильном приложении
- [ ] Поддержано сканирование штрих-кода партии и зоны оперативного запаса
- [ ] Реализовано списание со склада и пополнение линии при подтверждении
- [ ] Валидация вводимых количеств и проверка доступности партии
- [ ] Ведутся логи всех операций перемещения

#### Критерии приемки:

- [ ] Оператор может вручную зафиксировать перемещение полуфабриката со склада на линию
- [ ] При фиксации указывается количество и сканируется штрих-код партии
- [ ] Система проверяет, что указанное количество доступно в партии
- [ ] После подтверждения остатки автоматически обновляются на складе и на линии
- [ ] Процесс фиксации перемещения занимает не более 15-20 секунд

#### Задачи:

- Разработать UI для фиксации перемещений в мобильном приложении
- Реализовать сканирование партий и зон
- Интегрировать с системой учета остатков
- Реализовать валидацию доступности количеств
- Добавить логирование операций перемещения

### US5.1: Мобильное приложение с оффлайн-режимом для инвентаризации и утилизации

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US2.1, US2.2, US2.3 (процессы инвентаризации)
- [ ] Завершены US4.1, US4.2, US4.3 (процессы утилизации)
- [ ] Определена архитектура оффлайн-синхронизации
- [ ] Утвержден дизайн мобильного интерфейса для оффлайн-работы
- [ ] Готовы API endpoints для оффлайн-синхронизации

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализовано полное кэширование данных партий на мобильном устройстве
- [ ] Поддержана работа всех функций инвентаризации и утилизации без сети
- [ ] Реализована автоматическая синхронизация при появлении сети
- [ ] Обработаны сценарии конфликтующих изменений при синхронизации
- [ ] Приложение стабильно работает в условиях плохого покрытия сети

#### Критерии приемки (Acceptance Criteria):

- [ ] Оператор может проводить инвентаризацию в зонах с полным отсутствием сети
- [ ] Все данные о партиях кэшируются на устройстве перед началом инвентаризации
- [ ] Сканирование штрих-кодов и ввод количеств работают оффлайн
- [ ] При появлении сети данные автоматически синхронизируются с сервером
- [ ] При конфликтах данных оператор может выбрать приоритет (оффлайн/система)

#### Задачи:

- Разработать архитектуру оффлайн-кэширования
- Реализовать локальную базу данных на мобильном устройстве
- Настроить механизм синхронизации при восстановлении связи
- Реализовать разрешение конфликтов данных
- Протестировать работу в условиях нестабильной сети

---

### US5.2: Веб-интерфейс для работы с отчетами, справочниками и заказами

#### Definition of Ready (DoR):

- [ ] Завершены US1.1, US1.2, US1.3 (справочники)
- [ ] Завершены US3.1, US3.2, US3.3, US3.4 (заказы)
- [ ] Завершены US4.1, US4.2, US4.3, US4.4, US4.5, US4.6 (отчеты)
- [ ] Утвержден дизайн веб-интерфейса для технолога
- [ ] Определены требования к производительности веб-интерфейса

#### Definition of Done (DoD):

- [ ] Реализован веб-интерфейс для управления справочниками номенклатуры и зон
- [ ] Поддержаны все функции работы с отчетами (формирование, просмотр, фильтрация)
- [ ] Реализован интерфейс управления заказами (просмотр, корректировка, утверждение)
- [ ] Интерфейс оптимизирован для работы на больших экранах
- [ ] Производительность интерфейса соответствует требованиям (загрузка < 5 сек)

#### Критерии приемки:

- [ ] Технолог может управлять справочниками номенклатуры и зон через веб-интерфейс
- [ ] Доступны все типы отчетов: по срокам годности, пополнению, инвентаризации
- [ ] Технолог может просматривать, корректировать и утверждать заказы в веб-интерфейсе
- [ ] Интерфейс удобен для анализа данных на большом экране
- [ ] Все операции выполняются без задержек, интерфейс отзывчив

#### Задачи:

- Разработать веб-интерфейс для технолога
- Реализовать модуль управления справочниками
- Интегрировать генераторы отчетов
- Реализовать интерфейс управления заказами
- Оптимизировать производительность веб-приложения

---

### US5.3: Простые отчеты на мобильном устройстве с минимальными действиями

#### Definition of Ready (DoR):

- [ ] Завершены US4.1, US4.2, US4.4, US4.5 (отчеты)
- [ ] Утвержден дизайн упрощенного мобильного интерфейса отчетов
- [ ] Определены ключевые метрики и данные для мобильных отчетов
- [ ] Готовы API endpoints для мобильных отчетов

#### Definition of Done (DoD):

- [ ] Реализованы упрощенные версии отчетов для мобильного приложения
- [ ] Интерфейс использует крупный шрифт и минимальное количество элементов
- [ ] Навигация оптимизирована для быстрого доступа к ключевым данным
- [ ] Отчеты загружаются быстро даже при медленном соединении
- [ ] Интерфейс интуитивно понятен для оператора в условиях цеха

#### Критерии приемки:

- [ ] Все отчеты на мобильном устройстве имеют простой и понятный интерфейс
- [ ] Используется крупный шрифт, удобный для чтения в условиях цеха
- [ ] Для достижения цели требуется минимальное количество действий (тапов)
- [ ] Оператор может быстро найти нужную информацию без сложной навигации
- [ ] Интерфейс оптимизирован для работы в условиях производственного цеха

#### Задачи:

- Разработать упрощенный дизайн мобильных отчетов
- Реализовать адаптивные версии отчетов для мобильных устройств
- Оптимизировать навигацию и уменьшить количество действий
- Настроить крупные шрифты и контрастные элементы
- Протестировать удобство использования в условиях цеха

---
## Постановки на разработку функционала, реализуемого в рамках первого релиза

### US6.1: Автоматическое сканирование и блокировка партий

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US1.1, US1.2 (справочники номенклатуры со сроками хранения)
- [ ] Завершены US4.1, US4.2 (отчеты по срокам годности)
- [ ] Определены алгоритмы сканирования и критерии блокировки
- [ ] Настроено расписание автоматического сканирования (каждые N минут)
- [ ] Готовы API endpoints для блокировки партий и создания заданий

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован сервис автоматического сканирования сроков годности
- [ ] Система блокирует партии с истекшим сроком и скоро истекающие (за X часов)
- [ ] Сканирование выполняется по расписанию без ручного вмешательства
- [ ] Заблокированные партии исключаются из использования в производстве
- [ ] Ведутся логи всех операций блокировки

#### Критерии приемки (Acceptance Criteria):

- [ ] Система автоматически сканирует все партии каждые N минут
- [ ] Партии блокируются при истечении срока годности
- [ ] Партии блокируются за X часов до истечения срока (настраиваемый параметр)
- [ ] Блокировка предотвращает использование партии в любых операциях
- [ ] Исключен человеческий фактор в контроле сроков годности

#### Задачи:

- Реализовать сервис сканирования сроков годности
- Настроить scheduled job для автоматического сканирования
- Разработать алгоритмы блокировки по критериям
- Интегрировать с системой управления остатками
- Реализовать логирование операций блокировки

---

### US6.2: Автоматическое создание заданий на утилизацию

#### Definition of Ready (DoR):

- [ ] US6.1 завершена и протестирована
- [ ] Завершены US4.3 (процесс утилизации)
- [ ] Определены правила создания заданий на утилизацию
- [ ] Готовы API endpoints для создания заданий операторам
- [ ] Интегрирована система уведомлений операторов

#### Definition of Done (DoD):

- [ ] Реализовано автоматическое создание заданий при блокировке партий
- [ ] Задания отправляются на терминал оператора через систему уведомлений
- [ ] В задании указаны точные данные: штрих-код, локация, причина
- [ ] Поддержаны приоритеты заданий (просроченные > истекающие сегодня)
- [ ] Система отслеживает выполнение заданий

#### Критерии приемки:

- [ ] При блокировке партии система автоматически создает задание на утилизацию
- [ ] Задание отправляется на мобильное устройство оператора
- [ ] В задании четко указаны: штрих-код партии, локация, причина утилизации
- [ ] Оператор не ищет данные в отчете, а получает готовое задание
- [ ] Задания на утилизацию просроченных партий имеют высший приоритет

#### Задачи:

- Реализовать генератор заданий на утилизацию
- Интегрировать с системой push-уведомлений
- Настроить приоритеты заданий
- Разработать шаблоны заданий с необходимой информацией
- Реализовать отслеживание статусов заданий

---

### US6.3: Четкие задания на утилизацию со штрих-кодом и локацией

#### Definition of Ready (DoR):

- [ ] US6.2 завершена и протестирована
- [ ] Утвержден формат задания с полной информацией для оператора
- [ ] Определены обязательные атрибуты задания
- [ ] Готовы API endpoints для передачи детализированных заданий

#### Definition of Done (DoD):

- [ ] Задания содержат всю необходимую информацию для быстрого выполнения
- [ ] Реализована передача штрих-кода партии в задании
- [ ] Указана точная локация партии на складе или линии
- [ ] Включена причина утилизации и приоритет выполнения
- [ ] Интерфейс задания оптимизирован для быстрого выполнения

#### Критерии приемки:

- [ ] Оператор получает четкие задания на утилизацию со штрих-кодом и локацией
- [ ] Не требуется поиск данных в отчетах - вся информация в задании
- [ ] Задание содержит: штрих-код партии, точное местонахождение, причину утилизации
- [ ] Оператор может выполнить работу быстрее и без ошибок
- [ ] Интерфейс задания прост и интуитивно понятен

#### Задачи:

- Разработать детализированный формат заданий
- Реализовать передачу штрих-кодов и локаций в заданиях
- Оптимизировать UI мобильного приложения для отображения заданий
- Протестировать скорость выполнения заданий
- Собрать метрики эффективности автоматизированного процесса

---

### US7.1: Запрос разрешения на использование полуфабриката

#### Definition of Ready (DoR) - Критерии готовности к началу работы:

- [ ] Завершены US6.1, US6.2, US6.3 (автоматический контроль сроков)
- [ ] Интегрированы роботизированные линии через API
- [ ] Определен протокол взаимодействия с роботами (gRPC/WebSocket)
- [ ] Утвержден формат запроса разрешения от робота
- [ ] Готовы высокопроизводительные endpoints для проверки разрешений

#### Definition of Done (DoD) - Критерии завершенности:

- [ ] Реализован endpoint для запросов разрешения от роботов
- [ ] Система проверяет статус и срок годности партии в оперативном запасе
- [ ] Ответ предоставляется в формате, понятном роботизированной системе
- [ ] Интеграция стабильно работает в production-среде
- [ ] Обеспечена отказоустойчивость при недоступности системы

#### Критерии приемки (Acceptance Criteria):

- [ ] Роботизированная линия запрашивает разрешение на использование полуфабриката из оперативного запаса
- [ ] Запрос содержит: ID линии, ID контейнера, ID полуфабриката, количество
- [ ] Система проверяет возможность использования (статус, срок годности)
- [ ] Робот получает четкий ответ: разрешено/запрещено с причиной
- [ ] Робот уверен в безопасности используемого полуфабриката

#### Задачи:

- Разработать API для запросов разрешений от роботов
- Реализовать высокопроизводительную проверку статусов партий
- Интегрировать с системой контроля сроков годности
- Настроить протоколы связи (gRPC/WebSocket + REST fallback)
- Реализовать механизмы отказоустойчивости

---

### US7.2: Реальное время ответа на запрос робота

#### Definition of Ready (DoR):

- [ ] US7.1 завершена и протестирована
- [ ] Определены требования к производительности (< 100 мс)
- [ ] Настроено высокопроизводительное кэширование (Redis)
- [ ] Проведено нагрузочное тестирование инфраструктуры
- [ ] Готовы мониторинги времени ответа

#### Definition of Done (DoD):

- [ ] Время ответа на запрос разрешения не превышает 100 мс (95-й процентиль)
- [ ] Система использует кэш для быстрого доступа к данным о блокировках
- [ ] Реализована изоляция от медленных сервисов при проверке
- [ ] Мониторинг времени ответа работает в реальном времени
- [ ] Система масштабируется под пиковые нагрузки

#### Критерии приемки:

- [ ] Система отвечает роботу на запрос в режиме реального времени (< 100 мс)
- [ ] Время ответа гарантировано даже в часы пиковой нагрузки
- [ ] Отсутствие задержек в производственном процессе
- [ ] Робот не простаивает из-за ожидания ответа от системы
- [ ] Производительность системы соответствует требованиям роботизированной линии

#### Задачи:

- Оптимизировать производительность проверки разрешений
- Настроить Redis кэш для быстрого доступа к данным
- Реализовать circuit breaker для изоляции от медленных сервисов
- Настроить мониторинг и алертинг по времени ответа
- Провести нагрузочное тестирование

---

### US7.3: Автоматическое уведомление о блокировке партии

#### Definition of Ready (DoR):

- [ ] US7.1, US7.2 завершены и протестированы
- [ ] US6.1 завершена (автоматическая блокировка партий)
- [ ] Определен механизм уведомления роботов о блокировках
- [ ] Готовы API для push-уведомлений роботам
- [ ] Утверждены сценарии реакции робота на блокировку

#### Definition of Done (DoD):

- [ ] Реализована система мгновенных уведомлений роботов о блокировках
- [ ] Робот немедленно прекращает использование заблокированной партии
- [ ] Система уведомляет оператора о остановке линии
- [ ] Обеспечена надежная доставка уведомлений даже при временной недоступности
- [ ] Отработаны сценарии восстановления после блокировки

#### Критерии приемки:

- [ ] Система автоматически сообщает роботу о блокировке партии в оперативном запасе
- [ ] Робот немедленно прекращает использование заблокированной партии
- [ ] При остановке робот уведомляет оператора о причине
- [ ] Предотвращено использование просроченных полуфабрикатов в производстве
- [ ] Обеспечена безопасность пищевых продуктов

#### Задачи:

- Реализовать систему push-уведомлений для роботов
- Разработать протокол экстренных уведомлений о блокировках
- Интегрировать с системой автоматической блокировки партий
- Реализовать сценарии реакции робота на блокировки
- Настроить уведомления оператора об остановках линии

---
### US8.1: Отслеживание остатков в оперативном запасе в реальном времени

#### Definition of Ready (DoR):

- [ ] Завершены US7.1, US7.2, US7.3 (интеграция с роботами)
- [ ] Определен механизм получения данных о списаниях от роботов
- [ ] Утверждены пороги пополнения для каждого полуфабриката
- [ ] Готовы API для мониторинга остатков

#### Definition of Done (DoD):

- [ ] Реализован мониторинг остатков в оперативном запасе в реальном времени
- [ ] Система получает уведомления о каждом списании от роботов
- [ ] Рассчитывается точка пополнения с учетом скорости расхода
- [ ] Данные об остатках актуальны в любой момент времени

#### Критерии приемки:

- [ ] Система отслеживает остатки в оперативном запасе каждой линии в реальном времени
- [ ] На основе получаемых сообщений о списаниях от роботов
- [ ] Определяется момент необходимости пополнения (точка пополнения > 0)
- [ ] Расчет точки пополнения учитывает скорость расхода и время выполнения задания

#### Задачи:

- Реализовать получение данных о списаниях от роботов
- Настроить расчет точки пополнения
- Разработать мониторинг остатков в реальном времени

---

### US8.2: Автоматическое формирование задания на пополнение

#### Definition of Ready (DoR):

- [ ] US8.1 завершена и протестирована
- [ ] Завершены US4.5 (FEFO отчеты)
- [ ] Определен алгоритм выбора партии по FEFO
- [ ] Готовы API для создания заданий операторам

#### Definition of Done (DoD):

- [ ] Реализовано автоматическое создание заданий при достижении точки пополнения
- [ ] Система выбирает партию по FEFO для пополнения
- [ ] В задании указывается точное количество для перемещения
- [ ] Задание имеет высокий приоритет

#### Критерии приемки:

- [ ] Система автоматически формирует задание для оператора на пополнение конкретной линии
- [ ] В задании указывается точная партия со склада по FEFO и необходимое количество
- [ ] Исключен ручной выбор партии и ошибки оператора
- [ ] Количество равно ёмкости контейнера на линии

#### Задачи:

- Реализовать генератор заданий на пополнение
- Интегрировать с FEFO алгоритмом выбора партий
- Настроить расчет количества для пополнения

---

### US8.3: Упрощенный процесс пополнения через сканирование

#### Definition of Ready (DoR):

- [ ] US8.2 завершена и протестирована
- [ ] Интегрированы сканеры штрих-кодов
- [ ] Определен процесс подтверждения перемещения

#### Definition of Done (DoD):

- [ ] Реализован упрощенный интерфейс пополнения в мобильном приложении
- [ ] Поддержано сканирование штрих-кодов партии и зоны линии
- [ ] Перемещение фиксируется автоматически после сканирования

#### Критерии приемки:

- [ ] Оператор получает задания на пополнение линии
- [ ] Сканирует только штрих-коды (складской партии и зоны линии)
- [ ] Система автоматически фиксирует перемещение
- [ ] Процесс максимально упрощен для оператора

#### Задачи:

- Разработать упрощенный UI для пополнения
- Интегрировать сканирование штрих-кодов
- Реализовать автоматическую фиксацию перемещений

---

### US9.1: Интерфейс настройки параметров автозаказа

#### Definition of Ready (DoR):

- [ ] Завершены US3.1, US3.2 (расчет автозаказа)
- [ ] Определены все параметры правил (Min, Max, точка заказа)
- [ ] Утвержден интерфейс настройки правил

#### Definition of Done (DoD):

- [ ] Реализован веб-интерфейс для настройки параметров автозаказа
- [ ] Технолог может самостоятельно настраивать правила без разработчиков
- [ ] Поддержана валидация вводимых параметров

#### Критерии приемки:

- [ ] Технолог имеет интерфейс для самостоятельной настройки параметров автозаказа
- [ ] Настраиваются: Min, Max, точка заказа, кратность для каждого полуфабриката
- [ ] Гибкое управление запасами без участия разработчиков

#### Задачи:

- Разработать UI для настройки правил
- Реализовать валидацию параметров
- Интегрировать с системой расчета автозаказа

---

### US9.2: Настройка коэффициентов сезонности

#### Definition of Ready (DoR):

- [ ] US9.1 завершена и протестирована
- [ ] Определены алгоритмы учета сезонности
- [ ] Утверждены форматы коэффициентов

#### Definition of Done (DoD):

- [ ] Реализована настройка коэффициентов сезонности для правил автозаказа
- [ ] Поддержаны помесячные коэффициенты
- [ ] Коэффициенты учитываются при расчете автозаказа

#### Критерии приемки:

- [ ] Технолог может настраивать коэффициент сезонности для правил автозаказа
- [ ] Увеличение запасов в периоды высокого спроса
- [ ] Помесячные коэффициенты с выбором шаблона

#### Задачи:

- Добавить настройку коэффициентов сезонности в UI
- Интегрировать сезонность в алгоритм расчета
- Реализовать шаблоны коэффициентов

---

### US9.3: Групповая настройка правил

#### Definition of Ready (DoR):

- [ ] US9.1, US9.2 завершены и протестированы
- [ ] Определены механизмы группового применения правил
- [ ] Утвержден интерфейс групповых операций

#### Definition of Done (DoD):

- [ ] Реализовано применение настроек правил к группе товаров
- [ ] Поддержана фильтрация товаров по категориям
- [ ] Обеспечена валидация групповых изменений

#### Критерии приемки:

- [ ] Технолог может применять настройки правил к группе товаров одновременно
- [ ] Экономия времени на конфигурации
- [ ] Фильтр по категориям товаров

#### Задачи:

- Реализовать групповые операции с правилами
- Разработать фильтры по категориям
- Настроить валидацию групповых изменений

---

### US10.1: Автоматическая отправка заказов в ЛЦ

#### Definition of Ready (DoR):

- [ ] Завершены US3.1-US3.4 (управление заказами)
- [ ] Настроена интеграция с системой ЛЦ через API
- [ ] Определен формат данных для передачи заказов

#### Definition of Done (DoD):

- [ ] Реализована автоматическая отправка утвержденных заказов в ЛЦ
- [ ] Используется API интеграции с логистическим центром
- [ ] Исключен ручной ввод данных

#### Критерии приемки:

- [ ] Система автоматически отправляет утвержденные заказы в систему ЛЦ через API
- [ ] Исключен ручной ввод и связанные с ним ошибки
- [ ] Формат данных соответствует требованиям ЛЦ

#### Задачи:

- Реализовать интеграцию с API ЛЦ
- Настроить форматирование данных заказов
- Автоматизировать процесс отправки

---

### US10.2: Обработка ответов от ЛЦ

#### Definition of Ready (DoR):

- [ ] US10.1 завершена и протестирована
- [ ] Определены callback endpoints для получения статусов
- [ ] Утверждены сценарии обработки ответов

#### Definition of Done (DoD):

- [ ] Реализована обработка ответов от ЛЦ (подтверждение, ошибка, изменение)
- [ ] Статус заказа автоматически обновляется в системе
- [ ] Поддержано автоматическое применение изменений от ЛЦ

#### Критерии приемки:

- [ ] Система обрабатывает ответы от ЛЦ (подтверждение, ошибка, изменение количества)
- [ ] Автоматическое обновление статуса заказа в системе
- [ ] Сквозная видимость процесса
- [ ] Автоматическое применение изменений при статусе "Изменен"

#### Задачи:

- Реализовать callback endpoints
- Настроить обработку статусов от ЛЦ
- Автоматизировать применение изменений

---

### US10.3: Отслеживание статусов заказов

#### Definition of Ready (DoR):

- [ ] US10.2 завершена и протестирована
- [ ] Определены статусы заказов для отображения
- [ ] Утвержден интерфейс отслеживания статусов

#### Definition of Done (DoD):

- [ ] Реализовано отображение статусов заказов в системе
- [ ] Технолог видит текущий статус без обращения в ЛЦ
- [ ] Поддержаны статусы: "Передан в ЛЦ", "Подтвержден", "В пути"

#### Критерии приемки:

- [ ] Технолог видит в системе статус заказа ("Передан в ЛЦ", "Подтвержден", "В пути")
- [ ] Не требуется связываться с ЛЦ для выяснения обстановки
- [ ] Актуальная информация о статусе выполнения заказа

#### Задачи:

- Реализовать отображение статусов заказов
- Настроить обновление статусов в реальном времени
- Разработать UI для отслеживания заказов

---

### US11.1: Фиксация списаний по разным причинам

#### Definition of Ready (DoR):

- [ ] Завершены US4.3, US6.3 (процессы утилизации)
- [ ] Определен справочник причин списания
- [ ] Утвержден процесс фиксации списаний

#### Definition of Done (DoD):

- [ ] Реализована фиксация списаний не только по просрочке, но и по другим причинам
- [ ] Поддержан выбор причины из справочника
- [ ] Унифицирован учет всех потерь

#### Критерии приемки:

- [ ] Оператор может зафиксировать списание не только по причине просрочки
- [ ] Доступны причины: брак, бой, порча, хищение
- [ ] Выбор из справочника причин
- [ ] Унифицированный учет всех потерь

#### Задачи:

- Создать справочник причин списания
- Расширить функциональность списаний
- Унифицировать учет потерь

---

### US11.2: Журнал аудита действий системы и пользователей

#### Definition of Ready (DoR):

- [ ] Определены события для аудита
- [ ] Утвержден формат журнала аудита
- [ ] Определены требования к хранению логов

#### Definition of Done (DoD):

- [ ] Реализован полный и неизменяемый журнал аудита
- [ ] Фиксируются все действия системы и пользователей
- [ ] Журнал доступен для расследования инцидентов

#### Критерии приемки:

- [ ] Технолог видит полный и неизменяемый журнал аудита
- [ ] Фиксируются все действия системы (блокировки, списания) и пользователей
- [ ] Проведение расследования инцидентов
- [ ] Полная трассируемость операций

#### Задачи:

- Реализовать систему аудита
- Настроить логирование критических действий
- Разработать интерфейс просмотра журнала

---

### US12.1: Асинхронные очереди для интеграций

#### Definition of Ready (DoR):

- [ ] Определены интеграции для асинхронной обработки
- [ ] Выбрана и настроена система очередей (Kafka)
- [ ] Утверждены архитектурные решения

#### Definition of Done (DoD):

- [ ] Все взаимодействия с внешними системами используют асинхронные очереди
- [ ] Реализована надежность и устойчивость к сбоям
- [ ] Поддержаны механизмы повторных попыток

#### Критерии приемки:

- [ ] Все взаимодействия с внешними системами (ЛЦ, робот) используют асинхронные очереди сообщений
- [ ] Обеспечена надежность и устойчивость к сбоям
- [ ] Использование Kafka для асинхронной коммуникации

#### Задачи:

- Настроить Kafka для асинхронной обработки
- Реализовать механизмы повторных попыток
- Интегрировать внешние системы через очереди

---

### US12.2: Производительность критических запросов

#### Definition of Ready (DoR):

- [ ] Определены критические endpoints (запросы от робота)
- [ ] Установлены целевые показатели производительности
- [ ] Проведено базовое нагрузочное тестирование

#### Definition of Done (DoD):

- [ ] Критические запросы (от робота) обрабатываются менее чем за 100 мс
- [ ] Обеспечена стабильность производительности под нагрузкой
- [ ] Реализовано кэширование для быстрого доступа

#### Критерии приемки:

- [ ] Критические запросы (от робота) обрабатываются системой менее чем за 100 мс
- [ ] Непростаивание производства
- [ ] Гарантированное время ответа для роботизированных линий

#### Задачи:

- Оптимизировать производительность критических endpoints
- Реализовать кэширование данных
- Провести нагрузочное тестирование

---

### US12.3: Ролевая модель и разграничение прав

#### Definition of Ready (DoR):

- [ ] Определены роли пользователей (кассир, оператор линии, администратор, техник)
- [ ] Утверждена матрица прав доступа
- [ ] Определены требования к аутентификации

#### Definition of Done (DoD):

- [ ] Реализована ролевая модель доступа (RBAC)
- [ ] Настроено разграничение прав для разных ролей
- [ ] Обеспечена безопасность данных

#### Критерии приемки:

- [ ] Система имеет ролевую модель и разграничение прав доступа к функциям
- [ ] Роли: кассир, оператор линии, администратор, техник
- [ ] Защита от несанкционированных действий
- [ ] Обеспечение безопасности данных

#### Задачи:

- Реализовать систему ролей и прав
- Настроить разграничение доступа
- Интегрировать с системой аутентификации