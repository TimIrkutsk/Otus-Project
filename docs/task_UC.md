# Постановки на разработку по Use Case

## Постановки на разработку функционала, реализуемого в рамках MVP

### UC1 - Сформировать отчет по сроку годности

#### Задача 1.1: Разработать API endpoint для формирования отчета

**Критерий готовности к работе:**

- [ ] Утверждена спецификация API согласно проекту
- [ ] Определены параметры отчета из UC1: зона хранения, группа товаров, статус срока годности, формат вывода
- [ ] Готовы модели данных для партий из ER-диаграммы

**Критерий проверки требований:**

- [ ] Endpoint возвращает данные с колонками из UC1: Штрих-код, Наименование, Партия, Срок годности, Остаток, Локация, Статус
- [ ] Поддерживает фильтрацию по зонам хранения из справочника UC5
- [ ] Время формирования отчета на экран не превышает 5-7 секунд (требование UC1)
- [ ] Данные в отчете строго соответствуют данным на момент формирования

#### Задача 1.2: Реализовать фронтенд интерфейс для отчета

**Критерий готовности к работе:**

- [ ] Утвержден дизайн интерфейса с цветовой индикацией статусов
- [ ] Готовы компоненты для фильтрации и отображения таблицы
- [ ] Настроена интеграция с API endpoint

**Критерий проверки требований:**

- [ ] Цветовая индикация: красный - просроченные, желтый - истекает сегодня, оранжевый - истекает завтра, серый - заблокированные
- [ ] Сортировка по умолчанию по полю "Срок годности" (по возрастанию)
- [ ] Отчет доступен для просмотра на веб-интерфейсе
- [ ] Интерфейс интуитивно понятен (требование USA2)

#### Задача 1.3: Реализовать бизнес-логику фильтрации и сортировки

**Критерий готовности к работе:**

- [ ] Определены алгоритмы фильтрации по статусам сроков годности
- [ ] Готовы SQL-запросы для выборки данных с учетом FEFO

**Критерий проверки требований:**

- [ ] Фильтрация работает по всем заданным параметрам: зона, группа товаров, статус
- [ ] Сортировка по сроку годности корректно отображает самые проблемные партии вверху
- [ ] Алгоритм обработки данных эффективен для 2000+ заказов в сутки

### UC2-MVP - Утилизировать партию по отчету

#### Задача 2.1: Разработать мобильный интерфейс для утилизации

**Критерий готовности к работе:**

- [ ] Утвержден UX flow для процесса утилизации в мобильном приложении
- [ ] Готовы компоненты сканирования штрих-кодов
- [ ] Реализована интеграция с камерой устройства

**Критерий проверки требований:**

- [ ] Оператор может сканировать штрих-код партии из отчета UC1
- [ ] Система подтверждает, что партия находится в отчете "к утилизации"
- [ ] Процесс подтверждения утилизации занимает не более 10 секунд

#### Задача 2.2: Реализовать API для подтверждения утилизации

**Критерий готовности к работе:**

- [ ] Определена структура запроса/ответа для подтверждения утилизации
- [ ] Готовы сервисы для работы со статусами партий

**Критерий проверки требований:**

- [ ] API списывает остаток партии до нуля при подтверждении
- [ ] Статус партии изменяется на "Утилизирована"
- [ ] Фиксируется акт списания с причиной "Утилизация по сроку годности"
- [ ] Остатки обновляются в реальном времени

#### Задача 2.3: Реализовать валидацию и проверки

**Критерий готовности к работе:**

- [ ] Определены бизнес-правила для валидации операций утилизации
- [ ] Готовы механизмы проверки соответствия партии отчету

**Критерий проверки требований:**

- [ ] Система предотвращает утилизацию партий не из отчета UC1
- [ ] При сканировании несоответствующей партии выводится предупреждение
- [ ] Поддерживается ручной ввод ID партии при повреждении штрих-кода

### UC3-MVP - Пополнить оперативный запас у робота по отчету

#### Задача 3.1: Разработать интерфейс выбора партии для пополнения

**Критерий готовности к работе:**

- [ ] Утвержден процесс выбора партии из отчета UC1
- [ ] Реализован доступ к отчету сроков годности из мобильного приложения

**Критерий проверки требований:**

- [ ] Оператор может открыть отчет UC1 для нужного полуфабриката
- [ ] Отчет показывает партии отсортированные по FEFO
- [ ] Оператор может выбрать партию из верхней строки отчета

#### Задача 3.2: Реализовать API для фиксации перемещения

**Критерий готовности к работы:**

- [ ] Определена структура данных для операций перемещения
- [ ] Готовы сервисы для обновления остатков

**Критерий проверки требований:**

- [ ] API списывает количество со складской партии
- [ ] API добавляет количество к оперативному запасу линии
- [ ] Фиксируется акт внутреннего перемещения
- [ ] Процесс фиксации занимает не более 15-20 секунд

#### Задача 3.3: Реализовать проверки при перемещении

**Критерий готовности к работе:**

- [ ] Определены правила валидации операций перемещения
- [ ] Готовы механизмы проверки доступности партий

**Критерий проверки требований:**

- [ ] Система проверяет, что выбранная партия доступна и не заблокирована
- [ ] При обнаружении просроченной партии выводится предупреждение
- [ ] Поддерживается выбор альтернативной партии при недостатке количества

### UC4 - Провести инвентаризацию

#### Задача 4.1: Реализовать оффлайн-режим мобильного приложения

**Критерий готовности к работе:**

- [ ] Утверждена архитектура оффлайн-хранения данных
- [ ] Реализованы механизмы кэширования данных на устройстве

**Критерий проверки требований:**

- [ ] Данные всех партий ресторана кэшируются на мобильном устройстве
- [ ] Сканирование и ввод данных работают без сетевого соединения
- [ ] Автоматическая синхронизация при восстановлении связи

#### Задача 4.2: Разработать API для управления инвентаризацией

**Критерий готовности к работе:**

- [ ] Определены endpoints для создания заданий и синхронизации данных
- [ ] Готовы сервисы для расчета расхождений

**Критерий проверки требований:**

- [ ] Система формирует задания по расписанию или по инициативе оператора
- [ ] Автоматический расчет расхождений между фактом и системой
- [ ] Автоматическая коррекция остатков при расхождениях ≤ 4000 ед.
- [ ] Уведомление технолога при расхождениях > 4000 ед.

#### Задача 4.3: Реализовать процесс сканирования и ввода данных

**Критерий готовности к работе:**

- [ ] Утвержден UX для последовательного сканирования партий
- [ ] Реализованы компоненты для работы со штрих-кодами

**Критерий проверки требований:**

- [ ] Внесение данных по одной партии занимает 3-5 секунд
- [ ] Автозаполнение данных при распознавании штрих-кода
- [ ] Поддержка ручного ввода при поврежденных штрих-кодах
- [ ] Фокус автоматически переходит к следующему сканированию

#### Задача 4.4: Реализовать обработку конфликтов при синхронизации

**Критерий готовности к работе:**

- [ ] Определены алгоритмы разрешения конфликтующих изменений
- [ ] Готовы механизмы уведомления о конфликтах

**Критерий проверки требований:**

- [ ] Обнаружение конфликтующих изменений при синхронизации
- [ ] Запрос решения оператора по приоритету данных
- [ ] Применение выбранного оператором приоритета

### UC5 - Вести справочники

#### Задача 5.1: Разработать веб-интерфейс для управления номенклатурой

**Критерий готовности к работе:**

- [ ] Утвержден дизайн интерфейса для CRUD операций со справочниками
- [ ] Готовы компоненты формы создания/редактирования позиций

**Критерий проверки требований:**

- [ ] Возможность создания/редактирования полуфабрикатов с атрибутами: название, ед. измерения, категория, срок хранения
- [ ] Проверка уникальности наименования
- [ ] Валидация вводимых данных (срок хранения - положительное число)
- [ ] Пагинация и поиск при большом объеме данных

#### Задача 5.2: Реализовать управление складскими зонами

**Критерий готовности к работе:**

- [ ] Определена структура иерархии складских зон
- [ ] Готовы компоненты для древовидного отображения зон

**Критерий проверки требований:**

- [ ] Создание/редактирование зон с атрибутами: название, тип, родительская зона
- [ ] Иерархическое отображение структуры склада
- [ ] Назначение штрих-кодов зонам для сканирования оператором

#### Задача 5.3: Реализовать ролевую модель доступа

**Критерий готовности к работе:**

- [ ] Определены роли и права доступа согласно FR7.1-FR7.3
- [ ] Реализована система аутентификации и авторизации

**Критерий проверки требований:**

- [ ] Доступ к редактированию справочников только для технолога и администратора
- [ ] Запрет удаления позиций с историей операций
- [ ] Деактивация/архивация неиспользуемых позиций

### UC6 - Скорректировать заказ

#### Задача 6.1: Разработать интерфейс просмотра и редактирования заказов

**Критерий готовности к работе:**

- [ ] Утвержден дизайн интерфейса для работы с черновиками заказов
- [ ] Готовы компоненты отображения обоснования расчетов

**Критерий проверки требований:**

- [ ] Просмотр черновика заказа с обоснованием по каждой позиции
- [ ] Возможность ручного изменения количества
- [ ] Добавление/удаление позиций в заказе
- [ ] Цветовая индикация измененных технологом позиций

#### Задача 6.2: Реализовать workflow утверждения/отклонения заказов

**Критерий готовности к работе:**

- [ ] Определены статусы заказов и переходы между ними
- [ ] Реализованы механизмы уведомлений

**Критерий проверки требований:**

- [ ] Утверждение заказа с отправкой в ЛЦ
- [ ] Отклонение заказа с указанием причины
- [ ] Логирование всех действий технолога
- [ ] Уведомление о появлении новых черновиков заказов

## Постановки на разработку функционала, реализуемого в рамках первого релиза

### UC2 - Утилизировать партию

#### Задача 2.1: Реализовать систему автоматического создания заданий на утилизацию

**Критерий готовности к работе:**

- [ ] Утверждены критерии блокировки партий согласно UC7
- [ ] Реализована интеграция с сервисом контроля сроков

**Критерий проверки требований:**

- [ ] Автоматическое создание заданий при блокировке партий
- [ ] Приоритеты: просроченные > истекающие сегодня > истекающие завтра
- [ ] Задание содержит: локацию, штрих-код партии, причину утилизации
- [ ] Предотвращение дублирования заданий для одной партии

#### Задача 2.2: Разработать механизм push-уведомлений оператору

**Критерий готовности к работе:**

- [ ] Настроена интеграция с FCM/APNS для мобильных уведомлений
- [ ] Реализована очередь заданий для операторов

**Критерий проверки требований:**

- [ ] Мгновенная доставка заданий на мобильные устройства операторов
- [ ] Уведомление о новых заданиях с высоким приоритетом
- [ ] Отображение заданий в очереди оператора

#### Задача 2.3: Реализовать мониторинг выполнения заданий

**Критерий готовности к работе:**

- [ ] Определены сроки выполнения заданий (1 час)
- [ ] Реализованы механизмы эскалации

**Критерий проверки требований:**

- [ ] Автоматическое повышение приоритета просроченных заданий
- [ ] Уведомление технолога при массовой блокировке (>50% партий)
- [ ] Повторные уведомления для заданий старше 1 часа

### UC3 - Пополнить оперативный запас

#### Задача 3.1: Реализовать мониторинг остатков на линии в реальном времени

**Критерий готовности к работе:**

- [ ] Настроена интеграция с роботизированной линией через API
- [ ] Реализованы механизмы получения данных о списаниях

**Критерий проверки требований:**

- [ ] Отслеживание остатков каждого полуфабриката в оперативном запасе
- [ ] Автоматическое определение момента необходимости пополнения
- [ ] Расчет точки пополнения на основе прогноза продаж

#### Задача 3.2: Разработать алгоритм автоматического выбора партий по FEFO

**Критерий готовности к работе:**

- [ ] Определена логика выбора партий для пополнения
- [ ] Реализованы сервисы для работы с виртуальными сроками годности

**Критерий проверки требований:**

- [ ] Автоматический выбор партии с самым близким сроком годности
- [ ] Указание точного количества для перемещения (емкость контейнера)
- [ ] Исключение заблокированных партий из выбора

#### Задача 3.3: Реализовать процесс подтверждения пополнения с пересчетом сроков

**Критерий готовности к работе:**

- [ ] Определен алгоритм пересчета виртуального срока годности
- [ ] Реализована интеграция с роботом для обновления данных

**Критерий проверки требований:**

- [ ] Пересчет виртуального срока годности при пополнении
- [ ] Формула: (Y1*T1 + Y2*T2) / (Y1 + Y2)
- [ ] Принятие более раннего срока при добавлении партии
- [ ] Подтверждение роботу об обновлении данных о сроке годности

### UC7 - Заблокировать просроченную партию

#### Задача 7.1: Реализовать фоновое задание проверки сроков годности

**Критерий готовности к работе:**

- [ ] Определена периодичность проверки (каждые N минут)
- [ ] Реализован планировщик задач для регулярного сканирования

**Критерий проверки требований:**

- [ ] Автоматическое сканирование всех активных партий по расписанию
- [ ] Проверка тысяч партий за десятки секунд
- [ ] Выявление партий по критериям: просроченные, истекающие сегодня

#### Задача 7.2: Разработать механизм автоматической блокировки партий

**Критерий готовности к работе:**

- [ ] Определены статусы партий и переходы между ними
- [ ] Реализованы сервисы для изменения статусов

**Критерий проверки требований:**

- [ ] Автоматическое изменение статуса на "Заблокирована"
- [ ] Исключение заблокированных партий из алгоритмов пополнения и автозаказа
- [ ] Транзакционность изменения статуса и распространения информации

#### Задача 7.3: Реализовать систему уведомлений о блокировках

**Критерий готовности к работе:**

- [ ] Определены получатели уведомлений и каналы доставки
- [ ] Реализованы механизмы интеграции с сервисом уведомлений

**Критерий проверки требований:**

- [ ] Немедленное уведомление оператора о блокировках
- [ ] Уведомление технолога о критических ситуациях
- [ ] Журналирование всех действий по блокировке/разблокировке

### UC8 - Рассчитать автозаказ

#### Задача 8.1: Реализовать алгоритм расчета автозаказа

**Критерий готовности к работе:**

- [ ] Определена формула расчета: Max - Текущий остаток - Незавершенные заказы + Прогноз
- [ ] Реализованы сервисы для сбора входных данных

**Критерий проверки требований:**

- [ ] Расчет для каждой позиции с активными правилами
- [ ] Учет текущих остатков, незавершенных заказов, прогноза продаж
- [ ] Применение ограничений: минимальная партия, кратность, точка заказа

#### Задача 8.2: Разработать интеграцию с системой прогноза продаж

**Критерий готовности к работе:**

- [ ] Настроена интеграция с системой продаж через REST API
- [ ] Реализованы механизмы обработки ошибок связи

**Критерий проверки требований:**

- [ ] Получение прогноза продаж на период поставки
- [ ] Использование исторических данных при недоступности системы продаж
- [ ] Валидация отклонений прогноза (>75% от среднего)

#### Задача 8.3: Реализовать формирование и валидацию черновика заказа

**Критерий готовности к работе:**

- [ ] Определена структура черновика заказа
- [ ] Реализованы механизмы проверки данных

**Критерий проверки требований:**

- [ ] Включение только позиций с Заказ > 0
- [ ] Проверка на дубликаты и валидность данных
- [ ] Сохранение черновика со статусом "Рассчитан"
- [ ] Уведомление технолога о готовности черновика

### UC9 - Подтвердить списание

#### Задача 9.1: Реализовать систему выбора причин списания

**Критерий готовности к работе:**

- [ ] Определен фиксированный перечень причин списания
- [ ] Реализованы справочники причин и их валидация

**Критерий проверки требований:**

- [ ] Выбор причины из системного перечня: просрочка, брак, бой, порча
- [ ] Проверка соответствия причины и статуса партии
- [ ] Дополнительное подтверждение технолога для не заблокированных партий

#### Задача 9.2: Разработать механизм аудита списаний

**Критерий готовности к работе:**

- [ ] Определена структура акта списания с обязательными реквизитами
- [ ] Реализовано неизменяемое хранение данных

**Критерий проверки требований:**

- [ ] Фиксация акта списания: дата, время, партия, причина, количество, ответственный
- [ ] Невозможность изменения зафиксированных актов
- [ ] Полный журнал аудита по всем действиям системы и пользователей

#### Задача 9.3: Реализовать лимиты и эскалацию списаний

**Критерий готовности к работе:**

- [ ] Определены лимиты списаний для разных категорий
- [ ] Реализованы механизмы уведомления технолога

**Критерий проверки требований:**

- [ ] Требование подтверждения технолога при превышении лимитов
- [ ] Уведомление технолога через Push/email/SMS
- [ ] Запрет списания в оффлайн-режиме для заблокированных партий

### UC10 - Настроить правила автозаказа

#### Задача 10.1: Разработать веб-интерфейс для настройки правил

**Критерий готовности к работе:**

- [ ] Утвержден дизайн интерфейса с визуализацией параметров
- [ ] Реализованы компоненты для работы с правилами

**Критерий проверки требований:**

- [ ] Настройка Min Stock, Max Stock, Reorder Point для каждой позиции
- [ ] Визуализация в виде графика уровня запасов
- [ ] Валидация правил: Min < Reorder Point < Max

#### Задача 10.2: Реализовать управление параметрами поставщика

**Критерий готовности к работе:**

- [ ] Определены параметры связанные с ЛЦ
- [ ] Реализованы механизмы валидации значений

**Критерий проверки требований:**

- [ ] Настройка минимальной партии заказа и кратности
- [ ] Указание срока поставки в днях
- [ ] Проверка: минимальная партия ≤ Max запас

#### Задача 10.3: Реализовать массовую настройку и коэффициенты

**Критерий готовности к работе:**

- [ ] Определены алгоритмы группового применения правил
- [ ] Реализованы механизмы работы с коэффициентами

**Критерий проверки требований:**

- [ ] Применение настроек к группе товаров
- [ ] Настройка помесячных коэффициентов сезонности
- [ ] Включение/выключение учета прогноза продаж
- [ ] Логирование изменений правил

### UC11 - Проверить срок годности

#### Задача 11.1: Реализовать высокопроизводительный API для робота

**Критерий готовности к работе:**

- [ ] Настроена интеграция по gRPC/WebSocket согласно диаграмме
- [ ] Реализованы механизмы кэширования в Redis

**Критерий проверки требований:**

- [ ] Время ответа на запрос < 100 мс
- [ ] Доступность сервиса 99.99%
- [ ] Обработка сотен запросов в минуту

#### Задача 11.2: Разработать алгоритм проверки сроков годности

**Критерий готовности к работе:**

- [ ] Определена логика проверки с учетом виртуальных сроков
- [ ] Реализованы сервисы для работы с оперативным запасом

**Критерий проверки требований:**

- [ ] Проверка статуса партии (заблокирована/активна)
- [ ] Сравнение текущего времени с сроком годности
- [ ] Проверка с запасом на период готовки блюда

#### Задача 11.3: Реализовать механизмы отказоустойчивости

**Критерий готовности к работе:**

- [ ] Определена стратегия кэширования данных на роботе
- [ ] Реализованы fallback-механизмы при недоступности системы

**Критерий проверки требований:**

- [ ] Использование кэшированных данных при недоступности системы
- [ ] Автоматическое обновление кэша каждые 1 час
- [ ] Уведомление оператора при проблемах связи

### UC12 - Передать заказ в ЛЦ

#### Задача 12.1: Реализовать интеграцию с API логистического центра

**Критерий готовности к работе:**

- [ ] Настроено подключение к API ЛЦ согласно спецификации
- [ ] Реализованы механизмы аутентификации и авторизации

**Критерий проверки требований:**

- [ ] Формирование сообщения в формате ЛЦ
- [ ] Передача данных: ID заказа, ресторана, дата поставки, список позиций
- [ ] Обработка ответов: подтверждение, ошибка, изменение количества

#### Задача 12.2: Разработать систему повторных попыток отправки

**Критерий готовности к работе:**

- [ ] Определена стратегия повторных попыток (15 раз через 1 минуту)
- [ ] Реализована очередь сообщений в Kafka

**Критерий проверки требований:**

- [ ] Автоматические повторные попытки при ошибках связи
- [ ] Перевод заказа в статус "Ошибка отправки" после исчерпания попыток
- [ ] Идемпотентность процесса отправки

#### Задача 12.3: Реализовать обработку callback от ЛЦ

**Критерий готовности к работе:**

- [ ] Определены endpoint для приема статусов от ЛЦ
- [ ] Реализованы механизмы обновления статусов заказов

**Критерий проверки требований:**

- [ ] Обработка статусов: подтвержден, изменен, отклонен
- [ ] Автоматическое применение изменений от ЛЦ
- [ ] Уведомление технолога об изменениях и отклонениях

### UC13 - Сформировать задание на утилизацию

#### Задача 13.1: Реализовать систему планирования заданий

**Критерий готовности к работе:**

- [ ] Определены критерии создания заданий согласно UC13
- [ ] Реализован планировщик для регулярного сканирования

**Критерий проверки требований:**

- [ ] Сканирование партий по расписанию
- [ ] Выявление партий для утилизации по трем критериям
- [ ] Создание заданий с приоритетами на основе срочности

#### Задача 13.2: Разработать механизм распределения заданий операторам

**Критерий готовности к работе:**

- [ ] Определена логика распределения заданий между операторами
- [ ] Реализована система очередей заданий

**Критерий проверки требований:**

- [ ] Автоматическое назначение заданий операторам ресторана
- [ ] Учет загрузки операторов при распределении
- [ ] Балансировка нагрузки между операторами

#### Задача 13.3: Реализовать мониторинг и эскалацию заданий

**Критерий готовности к работе:**

- [ ] Определены сроки выполнения заданий (1 час)
- [ ] Реализованы механизмы контроля выполнения

**Критерий проверки требований:**

- [ ] Автоматическое повышение приоритета просроченных заданий
- [ ] Уведомление о массовой блокировке (>50% партий)
- [ ] Создание новых заданий при просрочке выполнения